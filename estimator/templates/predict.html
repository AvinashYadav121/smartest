 {% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>SmartEst – Smart Estimator</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="keywords" />
    <meta content="" name="description" />

    <!-- Favicons -->
    <link href="{% static 'img/favicon.png'%} " rel="icon" />
    <link href="{% static 'img/apple-touch-icon.png'%]" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS File -->
    <link href="{%static 'lib/bootstrap/css/bootstrap.min.css'%}" rel="stylesheet" />

    <!-- Libraries CSS Files -->
    <link href="{% static 'lib/font-awesome/css/font-awesome.min.css'%}" rel="stylesheet" />
    <link href="{% static 'lib/animate/animate.min.css'%}" rel="stylesheet" />
    <link href="{% static 'lib/ionicons/css/ionicons.min.css'%}" rel="stylesheet" />
    <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css'%}" rel="stylesheet" />

    <!-- Main Stylesheet File -->
    <link href="{% static 'style.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'style.css' %}">
  </head>

  <body>
    <div class="click-closed"></div>
    <!--/ Form Search Star /-->
    <div class="box-collapse">
      <div class="title-box-d">
        <h3 class="title-d">Search Property</h3>
      </div>
      <span class="close-box-collapse right-boxed ion-ios-close"></span>
      <div class="box-collapse-wrap form">
        <form class="form-a">
          <div class="row">
            <div class="col-md-12 mb-2">
              <div class="form-group">
                <label for="Type">Keyword</label>
                <input
                  type="text"
                  class="form-control form-control-lg form-control-a"
                  placeholder="Keyword"
                />
              </div>
            </div>
            <div class="col-md-6 mb-2">
              <div class="form-group">
                <label for="Type">Type</label>
                <select
                  class="form-control form-control-lg form-control-a"
                  id="Type"
                >
                  <option>All Type</option>
                  <option>For Rent</option>
                  <option>For Sale</option>
                  <option>Open House</option>
                </select>
              </div>
            </div>
            <div class="col-md-6 mb-2">
              <div class="form-group">
                <label for="city">City</label>
                <select
                  class="form-control form-control-lg form-control-a"
                  id="city"
                >
                  <option>All City</option>
                  <option>Alabama</option>
                  <option>Arizona</option>
                  <option>California</option>
                  <option>Colorado</option>
                </select>
              </div>
            </div>
            <div class="col-md-6 mb-2">
              <div class="form-group">
                <label for="bedrooms">Bedrooms</label>
                <select
                  class="form-control form-control-lg form-control-a"
                  id="bedrooms"
                >
                  <option>Any</option>
                  <option>01</option>
                  <option>02</option>
                  <option>03</option>
                </select>
              </div>
            </div>
            <div class="col-md-6 mb-2">
              <div class="form-group">
                <label for="garages">Garages</label>
                <select
                  class="form-control form-control-lg form-control-a"
                  id="garages"
                >
                  <option>Any</option>
                  <option>01</option>
                  <option>02</option>
                  <option>03</option>
                  <option>04</option>
                </select>
              </div>
            </div>
            <div class="col-md-6 mb-2">
              <div class="form-group">
                <label for="bathrooms">Bathrooms</label>
                <select
                  class="form-control form-control-lg form-control-a"
                  id="bathrooms"
                >
                  <option>Any</option>
                  <option>01</option>
                  <option>02</option>
                  <option>03</option>
                </select>
              </div>
            </div>
            <div class="col-md-6 mb-2">
              <div class="form-group">
                <label for="price">Min Price</label>
                <select
                  class="form-control form-control-lg form-control-a"
                  id="price"
                >
                  <option>Unlimite</option>
                  <option>₨50,000</option>
                  <option>₨100,000</option>
                  <option>₨150,000</option>
                  <option>₨200,000</option>
                </select>
              </div>
            </div>
            <div class="col-md-12">
              <button type="submit" class="btn btn-b">Search Property</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <!--/ Form Search End /-->

    <!--/ Nav Star /-->
    <nav class="navbar navbar-default navbar-trans navbar-expand-lg fixed-top">
      <div class="container">
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-toggle="collapse"
          data-target="#navbarDefault"
          aria-controls="navbarDefault"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>
        <a class="navbar-brand text-brand" href="{% url 'home' %}"
          >Smart<span class="color-b">EST</span></a
        >
        <button
          type="button"
          class="btn btn-link nav-search navbar-toggle-box-collapse d-md-none"
          data-toggle="collapse"
          data-target="#navbarTogglerDemo01"
          aria-expanded="false"
        >
          <span class="fa fa-search" aria-hidden="true"></span>
        </button>
        <div
          class="navbar-collapse collapse justify-content-center"
          id="navbarDefault"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'home' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="{% url 'about' %}">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="{% url 'predict' %}">Smart_EST</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'property_grid' %}">Property</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'blog_grid' %}">Blog</a>
            </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'contact' %}">Contact</a>
          </li>
        {% if user.is_authenticated %}
          <li class="nav-item d-flex align-items-center">
            <img src="{{ user.profile_image.url }}" width="35" height="35" class="rounded-circle me-2" alt="Profile">
            <div class="dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" data-bs-toggle="dropdown">
                {{ user.username }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                <li><a class="dropdown-item" href="{% url 'password_change' %}">Change Password</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Logout</a></li>
              </ul>
            </div>
          </li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'register' %}">Register</a></li>
        {% endif %}
        </div>
        <button
          type="button"
          class="btn btn-b-n navbar-toggle-box-collapse d-none d-md-block"
          data-toggle="collapse"
          data-target="#navbarTogglerDemo01"
          aria-expanded="false"
        >
          <span class="fa fa-search" aria-hidden="true"></span>
        </button>
      </div>
    </nav>
    <!--/ Nav End /-->



    <main class="main-section" style="padding: 20px; background-color: #f9f9f9; margin-top: 100px;">
  <div class="text-center mb-4">
    <h1 class="text-primary">Get Your Dream Home Estimate</h1>
    <p>Enter details below to receive a prediction powered by ML.</p>
  </div>

  <!-- Prediction Form -->
  <form id="predict-form" method="POST" class="mx-auto" style="max-width: 400px;">
    {% csrf_token %}
    <input type="number" name="total_sqft" placeholder="Total Sqft" required class="form-control mb-2" />
    <input type="number" name="bath" placeholder="Number of Bathrooms" required class="form-control mb-2" />
    <input type="number" name="bhk" placeholder="Number of BHK" required class="form-control mb-2" />
    
    <select name="location" class="form-control mb-3" required>
      <option value="">Select Location</option>
      {% for loc in locations %}
        <option value="{{ loc }}">{{ loc }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="btn btn-primary w-100">Get Estimate</button>
    <button type="reset" class="btn btn-outline-secondary w-100 mt-2">Reset</button>
  </form>
</main>

<!-- Modal to Show Prediction Result -->
<div class="modal fade" id="predictionModal" tabindex="-1" aria-labelledby="predictionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Prediction Result</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body" id="modal-message"></div>
    </div>
  </div>
</div>

<!-- House Loan EMI Calculator -->
<div class="container mt-5">
  <h4 class="text-center text-primary mb-3">House Loan EMI Calculator</h4>
  <div class="card p-4 bg-light shadow-sm">
    <div class="row g-3">
      <div class="col-md-4">
        <label>Loan Amount (₹):</label>
        <input type="number" class="form-control" id="loanAmount" required>
      </div>
      <div class="col-md-4">
        <label>Interest Rate (% per annum):</label>
        <input type="number" class="form-control" id="interestRate" required>
      </div>
      <div class="col-md-4">
        <label>Tenure (years):</label>
        <input type="number" class="form-control" id="tenure" required>
      </div>
    </div>
    <button class="btn btn-primary mt-3" onclick="calculateEMI()">Calculate EMI</button>
    <div id="emiResult" class="mt-3 text-success fw-bold" style="transition: all 0.3s;"></div>
  </div>
</div>


  <section id="services" class="services fade-in" style="padding: 2px; background-color: #ffffff; border-radius: 2px; margin-top: 3px;">
    <h2 style="text-align: center; margin-bottom: 2px;">Our Services</h2>
    <ul style="list-style: none; padding: 0; text-align: center;">
      <li style="margin-bottom: 1px;">✅ ML-based House Price Prediction</li>
      <li style="margin-bottom: 1px;">📊 Real-time Market Analytics</li>
      <li style="margin-bottom: 1px;">🏡 Trusted Seller Listings</li>
      <li style="margin-bottom: 1px;">📍 Location-wise Value Insights</li>
    </ul>
  </section>




    <!--/ footer Star /-->
    <section class="section-footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-4">
            <div class="widget-a">
              <div class="w-header-a">
                <h3 class="w-title-a text-brand">SmartEst</h3>
              </div>
              <div class="w-body-a">
                <p class="w-text-a color-text-a">
                  Smart-EST is a cutting-edge real estate platform that
                  leverages machine learning to provide accurate property price
                  predictions, market analytics, and trusted seller listings.
                  With a focus on user experience and data-driven insights,
                  Smart-EST empowers buyers and sellers to make informed
                  decisions in the real estate market.
                </p>
              </div>
              <div class="w-footer-a">
                <ul class="list-unstyled">
                  <li class="color-a">
                    <span class="color-text-a">Phone .</span>
                    contact@example.com
                  </li>
                  <li class="color-a">
                    <span class="color-text-a">Email .</span> +54 356 945234
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-sm-12 col-md-4 section-md-t3">
            <div class="widget-a">
              <div class="w-header-a">
                <h3 class="w-title-a text-brand">The Company</h3>
              </div>
              <div class="w-body-a">
                <div class="w-body-a">
                  <ul class="list-unstyled">
                    <li class="item-list-a">
                      <i class="fa fa-angle-right"></i> <a href="#">Site Map</a>
                    </li>
                    <li class="item-list-a">
                      <i class="fa fa-angle-right"></i> <a href="#">Legal</a>
                    </li>
                    <li class="item-list-a">
                      <i class="fa fa-angle-right"></i>
                      <a href="#">Agent Admin</a>
                    </li>
                    <li class="item-list-a">
                      <i class="fa fa-angle-right"></i> <a href="#">Careers</a>
                    </li>
                    <li class="item-list-a">
                      <i class="fa fa-angle-right"></i>
                      <a href="#">Affiliate</a>
                    </li>
                    <li class="item-list-a">
                      <i class="fa fa-angle-right"></i>
                      <a href="#">Privacy Policy</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-12 col-md-4 section-md-t3">
            <div class="widget-a">
              <div class="w-header-a">
                <h3 class="w-title-a text-brand">International sites</h3>
              </div>
              <div class="w-body-a">
                <ul class="list-unstyled">
                  <li class="item-list-a">
                    <i class="fa fa-angle-right"></i> <a href="#">Venezuela</a>
                  </li>
                  <li class="item-list-a">
                    <i class="fa fa-angle-right"></i> <a href="#">China</a>
                  </li>
                  <li class="item-list-a">
                    <i class="fa fa-angle-right"></i> <a href="#">Hong Kong</a>
                  </li>
                  <li class="item-list-a">
                    <i class="fa fa-angle-right"></i> <a href="#">Argentina</a>
                  </li>
                  <li class="item-list-a">
                    <i class="fa fa-angle-right"></i> <a href="#">Singapore</a>
                  </li>
                  <li class="item-list-a">
                    <i class="fa fa-angle-right"></i>
                    <a href="#">Philippines</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <nav class="nav-footer">
              <ul class="list-inline">
                <li class="list-inline-item">
                  <a href="#">Home</a>
                </li>
                <li class="list-inline-item">
                  <a href="#">About</a>
                </li>
                <li class="list-inline-item">
                  <a href="#">Property</a>
                </li>
                <li class="list-inline-item">
                  <a href="#">Blog</a>
                </li>
                <li class="list-inline-item">
                  <a href="#">Contact</a>
                </li>
              </ul>
            </nav>
            <div class="socials-a">
              <ul class="list-inline">
                <li class="list-inline-item">
                  <a href="#">
                    <i class="fa fa-facebook" aria-hidden="true"></i>
                  </a>
                </li>
                <li class="list-inline-item">
                  <a href="#">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                  </a>
                </li>
                <li class="list-inline-item">
                  <a href="#">
                    <i class="fa fa-instagram" aria-hidden="true"></i>
                  </a>
                </li>
                <li class="list-inline-item">
                  <a href="#">
                    <i class="fa fa-pinterest-p" aria-hidden="true"></i>
                  </a>
                </li>
                <li class="list-inline-item">
                  <a href="#">
                    <i class="fa fa-dribbble" aria-hidden="true"></i>
                  </a>
                </li>
              </ul>
            </div>
            <div class="copyright-footer">
              <p class="copyright color-text-a">
                &copy; Copyright
                <span class="color-a">SmartEst🏠</span> All Rights Reserved.
              </p>
            </div>
            <div class="credits">
              Designed by
              <a href="https://bootstrapmade.com/" class="color-a"
                >BootstrapMade</a
              >
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!--/ Footer End /-->

    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>
    <div id="preloader"></div>

    <!-- JavaScript Libraries -->
    <script src="{%static 'lib/jquery/jquery.min.js'%}"></script>
    <script src="{%static 'lib/jquery/jquery-migrate.min.js'%}"></script>
    <script src="{%static 'lib/popper/popper.min.js'%}"></script>
    <script src="{%static 'lib/bootstrap/js/bootstrap.min.js'%}"></script>
    <script src="{%static 'lib/easing/easing.min.js'%}"></script>
    <script src="{%static 'lib/owlcarousel/owl.carousel.min.js'%}"></script>
    <script src="{%static 'lib/scrollreveal/scrollreveal.min.js'%}"></script>
    <!-- Contact Form JavaScript File -->
    <script src="{%static 'contactform/contactform.js'%}"></script>

    <!-- Template Main Javascript File -->
    <script src="{%static 'js/main.js' %}"></script>

<!-- JavaScript -->
<script>
function calculateEMI() {
  const P = parseFloat(document.getElementById("loanAmount").value);
  const R = parseFloat(document.getElementById("interestRate").value);
  const N = parseInt(document.getElementById("tenure").value);

  if (!P || !R && R !== 0 || !N) {
    alert("Please fill all loan fields correctly.");
    return;
  }

  const r = R / (12 * 100); // monthly rate
  const n = N * 12;          // number of months

  let emi, totalPayment, totalInterest;

  if (r === 0) {
    emi = P / n;
    totalPayment = P;
    totalInterest = 0;
  } else {
    emi = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
    totalPayment = emi * n;
    totalInterest = totalPayment - P;
  }

  document.getElementById("emiResult").innerHTML = `
    <div class="alert alert-info">
      <strong>Monthly EMI:</strong> ₹${emi.toFixed(2)}<br>
      <strong>Total Payment:</strong> ₹${totalPayment.toFixed(2)}<br>
      <strong>Total Interest:</strong> ₹${totalInterest.toFixed(2)}
    </div>
  `;
}

// AJAX for Prediction
$(document).ready(function () {
  $('#predict-form').on('submit', function (e) {
    e.preventDefault();

    $.ajax({
      type: 'POST',
      url: "{% url 'predict' %}",
      data: $(this).serialize(),
      success: function (response) {
        let message = '';
        if (response.prediction) {
          const predictedValue = parseFloat(response.prediction.replace(/[^\d.]/g, ''));
          const priceInRupees = predictedValue * 100000;

          $('#loanAmount').val(priceInRupees.toFixed(0));

          message = `<h4 class="text-success">Estimated Price: ₹${predictedValue.toFixed(2)} Lakhs</h4>`;
        } else if (response.error) {
          message = `<h4 class="text-danger">${response.error}</h4>`;
        } else {
          message = `<h4 class="text-danger">Unexpected error occurred.</h4>`;
        }

        $('#modal-message').html(message);
        $('#predictionModal').modal('show');
      },
      error: function () {
        $('#modal-message').html('<h4 class="text-danger">Server error. Try again later.</h4>');
        $('#predictionModal').modal('show');
      }
    });
  });
});
</script>
  </body>
</html>

